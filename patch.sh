#!/data/data/com.termux/files/usr/bin/bash
PACKAGE_NAME="com.dts.freefireth"
MODULE_NAME="libil2cpp.so"
PATCH_BYTES='\x00\x00\x80\xD2\xC0\x03\x5F\xD6'
EXPECTED_HEX="000080D2C0035FD6"
OFFSETS_HEX=(
  0x2A69F24 0x2A72FC4 0x2A73288 0x2AD7338 0x2AD7DA8 0x2AD8934
  0x2AE2CF0 0x2AE2F78 0x2AE3028 0x2AE30D8 0x2AE31D4 0x2AE3284
  0x2AE3334 0x2AE33E4 0x2AE3698 0x2AE41EC 0x2AE4AD8 0x2AE4D68
  0x2AE581C 0x2AE5B00 0x2AE5BBC 0x2AE5C98 0x2AE5D50 0x2AE6148
  0x2AE63DC 0x2AE670C 0x2AE69E4 0x2AE7314 0x2AE745C 0x2AE8148
  0x2AE8AC8 0x2AE8BF4 0x2AE8CFC 0x2AE8DEC 0x2AE8EC0 0x2AE8F94
  0x2AE9068 0x2AE92C0 0x2AE93A8 0x2AE9464 0x2AE95A8 0x2AE96A8
  0x2AE9790 0x2AE9878 0x2AE994C 0x2AE9A04 0x2AE9C54 0x2AEAF20
  0x2AEB178 0x2AEB324 0x2AEB3F4 0x2AEB6F8 0x2AEC880 0x2AECBA8
  0x2ADE520 0x2ADE734 0x2ADEFd4 0x2ADF7A4 0x2ADFAB0 0x2AE0E00
  0x2AE16CC 0x2AE1D44 0x2AE2074 0x2AE2CF0 0x2B06180 0x2CEA71C
  0x2CEA71C 0x6C9DD40 0x2AFC5E8 0x2A7052C 0x2A50510 0x2A70748 0x2A70B14
  0x2cfc708 0x2cfee68 0x2cfe424 0x2cfcc94 0x2cfd498 0x2d033bc
  0x2d039fc 0x2d03c38 0x2d03e20 0x2d03f40 0x2d041ec 0x2d048c8
  0x2d04dbc 0x2d04498 0x2d045c4 0x2cfd61c 0x2d006cc 0x2cfefec
  0x2cffb18 0x2cfffa0 0x2d02468 0x2d028d8 0x2d02a5c 0x2d02f34 0x2cea71c
  0x2A723A4 0x2A728CC 0x2A72FC4 0x2AAAFA0 0x2AAB0B4 0x5BC365C
  0x7638868 0x7637AA4 0x4A7595C 0x7638868 0x7767D08 0x8072DC4 0x8072E38
  0x70370F0 0x70370F8 0x7037324 0x703743C 0x2AEB178 0x739436c 0x7394350
  0x7394374 0x7394358 0x739437c 0x7394364 0x7394384 0x73943c0
  0x7394534 0x73946f4 0x73948c4 0x7394a08 0x7394b5c 0x8028c00 0x802f820
  0x802f728 0x802f968 0x805dd38 0x805dd40 0x805dd48 0x8055e90
  0x7860b98 0x78608f8 0x7860a1c 0x7860b40 0x78569dc 0x7860058 0x808b0c8
  0x6D8A2F4 0x6d8a2f4 0x805C524 0x8057D90 0x380a0c0 0x380a2cc 0x380a0c0 0x380a2cc
  0x380a464 0x380a6a0 0x380a910 0x380a984 0x380aa00 0x380aa74 0x3808370
  0x380aaf0 0x380ac14 0x380c0b0 0x380c1bc 0x380c308 0x2ae0470 0x2ae12cc
  0x2ad94ac 0x2ad68f8 0x2ad6a1c 0x419d3c4 0x419de04 0x4eba820 0x4eba464
  0x4EB7848 0x4EB78A4 0x4ebb80c 0x3d482a0 0x2e9dfc0 0x2e9e0f4 0x2e9cfc4
  0x2e9ceac 0x2e9aaa0 0x3b52970 0x3b529e4 0x3b528e4 0x33c20a4 0x33c5000
  0x419c7d0 0x419cc18 0x419cd50 0x419d0a0 0x419d3c4 0x419d528 0x419d674
  0x6af82ec 0x380aaf0 0x3808174 0x380ac14 0x380c0b0 0x2bf0fa0 0x2bf1464
  0x2bf1488 0x3d4c8b8 0x3d4c858 0x3d4cab4 0x3d4cb30 0x3d4cb94 0x3d4cd50
  0x27f1e30 0x27f1dc8 0x380184c 0x37b5734 0x37b5b80 0x37b45dc 0x37b46b8
  0x37b48b0 0x37b3cd4 0x37b3cdc 0x37b3de8 0x37b3ef8 0x37b4090  0x37b3f80
  0x37b41a0 0x37b42ac 0x37b43bc 0x37b44cc 0x37b45dc 0x37b46b8
  0x37b4964 0x37b4a74 0x37b47a0 0x37b4b84 0x37b4c94 0x37b4da4 0x37b4eb4
  0x37b4fc4 0x37b50d4 0x37b51e4 0x37b52f4 0x37b5404 0x37b5514 0x37b5624
  0x37b5734 0x37b5b80 0x37b5cf0
  0x3800130 0x3800190 0x3800244 0x38002f8 0x3800010 0x38000a0 0x380038c
  0x38006a8 0x3800724 0x38008e4 0x3800960 0x3800ab4 0x3800cbc 0x3800d5c
  0x380133c 0x38013d0 0x3801568 0x38015e4 0x3800fbc 0x380184c
)
[[ "$EUID" -ne 0 ]] && { echo "üö´ Script n√†y c·∫ßn quy·ªÅn root!"; exit 1; }
SO_PATH=$(find /data/app/ -type f -path "*/lib*/$MODULE_NAME" -name "$MODULE_NAME" 2>/dev/null | grep "$PACKAGE_NAME" | head -n 1)
if [[ -z "$SO_PATH" || ! -f "$SO_PATH" ]]; then
  echo "‚ùå Kh√¥ng t√¨m th·∫•y $MODULE_NAME cho package $PACKAGE_NAME."
  exit 1
fi
echo "üìÅ ƒê√£ t√¨m th·∫•y: $SO_PATH"
PATCHED=0
for OFFSET_HEX in "${OFFSETS_HEX[@]}"; do
  OFFSET=$((OFFSET_HEX))
  CURRENT_HEX=$(dd if="$SO_PATH" bs=1 skip=$OFFSET count=8 2>/dev/null | xxd -p -c 8)
  if [[ "${CURRENT_HEX^^}" == "$EXPECTED_HEX" ]]; then
    echo "‚úîÔ∏è  Offset 0x$(printf '%X' $OFFSET): ƒê√£ patch r·ªìi."
  else
    printf "$PATCH_BYTES" | dd of="$SO_PATH" bs=1 seek=$OFFSET conv=notrunc 2>/dev/null
    NEW_HEX=$(dd if="$SO_PATH" bs=1 skip=$OFFSET count=8 2>/dev/null | xxd -p -c 8)
    if [[ "${NEW_HEX^^}" == "$EXPECTED_HEX" ]]; then
      echo "‚úÖ Offset 0x$(printf '%X' $OFFSET): Patch th√†nh c√¥ng!"
      PATCHED=$((PATCHED + 1))
    else
      echo "‚ö†Ô∏è  Offset 0x$(printf '%X' $OFFSET): Patch th·∫•t b·∫°i!"
    fi
  fi
done
echo "üéØ ƒê√£ patch th√†nh c√¥ng $PATCHED offset(s)"
echo "üì¶ File: $SO_PATH"